<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Image Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #1a0d2e 0%, #16213e 50%, #0f4c75 100%);
      min-height: 100vh;
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow-x: hidden;
      position: relative;
    }

    .sample-images {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .sample-img {
      position: absolute;
      border-radius: 12px;
      opacity: 0.4;
      transition: opacity 0.3s ease;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .sample-img:nth-child(1) {
      top: 10%;
      left: 5%;
      width: 180px;
      height: 120px;
      background: linear-gradient(45deg, #ff6b6b, #ffa726);
      animation: float1 8s ease-in-out infinite;
    }

    .sample-img:nth-child(2) {
      top: 20%;
      right: 8%;
      width: 200px;
      height: 140px;
      background: linear-gradient(45deg, #4ecdc4, #44a08d);
      animation: float2 10s ease-in-out infinite;
    }

    .sample-img:nth-child(3) {
      bottom: 15%;
      left: 3%;
      width: 160px;
      height: 200px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      animation: float3 12s ease-in-out infinite;
    }

    .sample-img:nth-child(4) {
      bottom: 25%;
      right: 5%;
      width: 140px;
      height: 180px;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      animation: float4 9s ease-in-out infinite;
    }

    .sample-img:nth-child(5) {
      top: 60%;
      right: 25%;
      width: 120px;
      height: 120px;
      background: linear-gradient(45deg, #43e97b, #38f9d7);
      animation: float1 11s ease-in-out infinite;
    }

    @keyframes float1 {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }

    @keyframes float2 {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(15px) rotate(-3deg); }
    }

    @keyframes float3 {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-25px) rotate(7deg); }
    }

    @keyframes float4 {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(18px) rotate(-5deg); }
    }

    .breadcrumb {
      position: relative;
      z-index: 10;
      padding: 20px 40px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
    }

    .breadcrumb a {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .breadcrumb a:hover {
      color: white;
    }

    .breadcrumb span {
      margin: 0 8px;
      color: rgba(255, 255, 255, 0.5);
    }

    /* Logo section */
    .logo-section {
      position: relative;
      z-index: 10;
      text-align: center;
      margin-bottom: 40px;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      background: #ff0050;
      color: white;
      padding: 8px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 18px;
      box-shadow: 0 4px 20px rgba(255, 0, 80, 0.3);
    }

    .logo::before {
      content: "Fi";
      background: white;
      color: #ff0050;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }

    .container {
      position: relative;
      z-index: 10;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 40px;
      text-align: center;
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .main-title {
      font-size: 3.8rem;
      font-weight: 700;
      color: white;
      margin-bottom: 30px;
      line-height: 1.1;
      max-width: 900px;
      animation: fadeInUp 1s ease-out;
    }

    .description {
      font-size: 1.3rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 60px;
      line-height: 1.6;
      max-width: 700px;
      font-weight: 300;
      animation: fadeInUp 1s ease-out 0.2s both;
    }

    /* Generator input section */
    .generator-section {
      width: 100%;
      max-width: 800px;
      margin-bottom: 40px;
      animation: fadeInUp 1s ease-out 0.4s both;
    }

    .input-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 50px;
      padding: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .format-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 40px;
      color: #333;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .format-selector:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .format-icon {
      width: 18px;
      height: 18px;
      background: #666;
      border-radius: 3px;
      position: relative;
    }

    .format-icon::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      right: 2px;
      bottom: 2px;
      border: 2px solid white;
      border-radius: 1px;
    }

    .main-input {
      flex: 1;
      border: none;
      outline: none;
      padding: 16px 20px;
      font-size: 16px;
      background: transparent;
      color: #333;
      font-weight: 400;
    }

    .main-input::placeholder {
      color: #888;
      font-style: italic;
    }

    .generate-button {
      background: linear-gradient(135deg, #ff0050 0%, #ff4081 100%);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 40px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 20px rgba(255, 0, 80, 0.3);
    }

    .generate-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(255, 0, 80, 0.4);
    }

    .generate-button:active {
      transform: translateY(0);
    }

    .generate-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .generate-icon {
      width: 20px;
      height: 20px;
      border: 2px solid currentColor;
      border-radius: 50%;
      position: relative;
    }

    .generate-icon::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 6px;
      height: 6px;
      background: currentColor;
      border-radius: 50%;
    }

    .guidelines-link {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: underline;
      font-size: 16px;
      transition: color 0.3s ease;
      animation: fadeInUp 1s ease-out 0.6s both;
    }

    .guidelines-link:hover {
      color: white;
    }

    /* Loading state */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .loading-content {
      text-align: center;
      color: white;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #ff0050;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .loading-subtext {
      font-size: 14px;
      opacity: 0.7;
    }

    /* Result modal */
    .result-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
      padding: 40px;
    }

    .result-content {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      max-width: 80vw;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      backdrop-filter: blur(30px);
    }

    .result-image {
      max-width: 100%;
      max-height: 60vh;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .result-actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .action-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .error-message {
      background: rgba(255, 0, 50, 0.1);
      border: 1px solid rgba(255, 0, 50, 0.3);
      color: #ff6b6b;
      padding: 15px 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
      display: none;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 20px;
      }
      
      .main-title {
        font-size: 2.5rem;
      }
      
      .description {
        font-size: 1.1rem;
      }
      
      .input-container {
        flex-direction: column;
        gap: 15px;
        padding: 20px;
        border-radius: 20px;
      }
      
      .main-input {
        text-align: center;
      }
      
      .sample-img {
        opacity: 0.2;
      }
      
      .breadcrumb {
        padding: 15px 20px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Sample decorative images -->
  <div class="sample-images">
    <div class="sample-img"></div>
    <div class="sample-img"></div>
    <div class="sample-img"></div>
    <div class="sample-img"></div>
    <div class="sample-img"></div>
  </div>

  <div class="container">
    <!-- Logo -->
    <div class="logo-section">
      <div class="logo">
         Firefly
      </div>
    </div>

    <h1 class="main-title">
      Online AI Image Generator: Create images from text.
    </h1>

    <p class="description">
      Bring your ideas to life with Firefly's Text to Image, 's online AI image generator. You can use text prompts to create and transform images quickly and easily, now with higher quality, more detail and improved lighting and colour.
    </p>

    <div class="generator-section">
      <div class="input-container">
        <div class="format-selector">
          <div class="format-icon"></div>
          <span>Image</span>
          <span style="margin-left: 5px;">‚ñº</span>
        </div>
        
        <input 
          type="text" 
          class="main-input" 
          placeholder="Describe what you want to generate"
          id="promptInput"
          maxlength="500"
        >
        
        <button class="generate-button" onclick="generateImage()" id="generateBtn">
          <div class="generate-icon"></div>
          <span id="btnText">Generate</span>
        </button>
      </div>
      
      <div class="error-message" id="errorMessage"></div>
    </div>

    <a href="#" class="guidelines-link">Generative AI User Guidelines</a>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div class="loading-text">Creating your masterpiece...</div>
      <div class="loading-subtext">This may take a few moments</div>
    </div>
  </div>

  <div class="result-modal" id="resultModal">
    <div class="result-content">
      <button class="close-btn" onclick="closeModal()">√ó</button>
      <img id="resultImage" class="result-image" alt="Generated image">
      
      <div class="result-actions">
        <button class="action-btn" onclick="saveImage('png')">
          üíæ Save as PNG
        </button>
        <button class="action-btn" onclick="saveImage('jpg')">
          üñºÔ∏è Save as JPG
        </button>
        <button class="action-btn" onclick="copyToClipboard()">
          üìã Copy
        </button>
        <button class="action-btn" onclick="shareImage()">
          üîó Share
        </button>
        <button class="action-btn" onclick="generateImage()">
          üîÑ Generate New
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentImageData = null;
    let currentPrompt = '';

    async function generateImage() {
      const prompt = document.getElementById("promptInput").value.trim();
      const generateBtn = document.getElementById("generateBtn");
      const btnText = document.getElementById("btnText");
      const loadingOverlay = document.getElementById("loadingOverlay");
      const errorMessage = document.getElementById("errorMessage");

      if (!prompt) {
        showError("Please enter a prompt to generate an image!");
        return;
      }

      errorMessage.style.display = 'none';
      
      generateBtn.disabled = true;
      btnText.textContent = "Generating...";
      loadingOverlay.style.display = 'flex';

      try {
        const res = await fetch("http://localhost:3000/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });

        if (!res.ok) {
          const err = await res.text();
          throw new Error(err);
        }

        const data = await res.json();
        
        currentImageData = data.image;
        currentPrompt = prompt;
        
        showResult(data.image);

      } catch (error) {
        console.error('Error generating image:', error);
        showError("Failed to generate image. Please check your connection and try again.");
      } finally {
        generateBtn.disabled = false;
        btnText.textContent = "Generate";
        loadingOverlay.style.display = 'none';
      }
    }

    function showResult(imageData) {
      const resultModal = document.getElementById('resultModal');
      const resultImage = document.getElementById('resultImage');
      
      resultImage.src = 'data:image/png;base64,' + imageData;
      resultImage.alt = 'Generated image: ' + currentPrompt;
      resultModal.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('resultModal').style.display = 'none';
    }

    function showError(message) {
      const errorMessage = document.getElementById("errorMessage");
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 5000);
    }

    function saveImage(format = 'png') {
      if (!currentImageData) {
        showError('No image to save!');
        return;
      }

      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          const mimeType = format === 'jpg' ? 'image/jpeg' : 'image/png';
          const quality = format === 'jpg' ? 0.9 : undefined;
          
          canvas.toBlob(function(blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-generated-${Date.now()}.${format}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }, mimeType, quality);
        };
        
        img.src = 'data:image/png;base64,' + currentImageData;
      } catch (error) {
        showError('Failed to save image. Please try again.');
      }
    }

    function copyToClipboard() {
      if (!currentImageData) {
        showError('No image to copy!');
        return;
      }

      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          canvas.toBlob(function(blob) {
            navigator.clipboard.write([
              new ClipboardItem({ 'image/png': blob })
            ]).then(() => {
              alert('Image copied to clipboard!');
            }).catch(() => {
              showError('Failed to copy to clipboard.');
            });
          });
        };
        
        img.src = 'data:image/png;base64,' + currentImageData;
      } catch (error) {
        showError('Failed to copy image.');
      }
    }

    function shareImage() {
      if (navigator.share && currentImageData) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          canvas.toBlob(function(blob) {
            const file = new File([blob], `ai-generated-${Date.now()}.png`, { type: 'image/png' });
            
            navigator.share({
              title: 'AI Generated Image',
              text: `Check out this AI-generated image: "${currentPrompt}"`,
              files: [file]
            }).catch(console.error);
          });
        };
        
        img.src = 'data:image/png;base64,' + currentImageData;
      } else {
        copyToClipboard();
      }
    }

    document.getElementById("promptInput").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        generateImage();
      }
    });

    document.getElementById('resultModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</body>
</html>